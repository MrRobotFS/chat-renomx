(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5262:function(e,t,r){Promise.resolve().then(r.bind(r,9626))},9626:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return h}});var a=r(7437),n=r(2265),o=r(9376),s=r(6281),i=r(4502);function l(e){let{variant:t="primary",size:r="md",className:n="",children:o,...s}=e;return(0,a.jsx)("button",{className:"".concat("font-medium rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"," ").concat({primary:"bg-primary hover:bg-primary-600 text-white focus:ring-primary",secondary:"bg-secondary hover:bg-secondary-600 text-dark focus:ring-secondary",outline:"border-2 border-primary text-primary hover:bg-primary hover:text-white focus:ring-primary"}[t]," ").concat({sm:"px-3 py-2 text-sm",md:"px-4 py-3 text-base",lg:"px-6 py-4 text-lg"}[r]," ").concat(n),...s,children:o})}function c(e){let{label:t,error:r,className:n="",...o}=e;return(0,a.jsxs)("div",{className:"space-y-2",children:[t&&(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:t}),(0,a.jsx)("input",{className:"input-field ".concat(r?"border-red-500 focus:ring-red-500":""," ").concat(n),...o}),r&&(0,a.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400",children:r})]})}function u(e){let{onLoginSuccess:t,onLoginError:r,onInputChange:o}=e,[s,u]=(0,n.useState)({username:"",password:""}),[d,m]=(0,n.useState)(!1),h=async e=>{e.preventDefault(),m(!0),null==o||o();try{let e=await i.x.login(s);e.success?t(e.user,e.access):r("Invalid credentials")}catch(e){console.error("Login failed:",e),r(e instanceof Error?e.message:"Login failed")}finally{m(!1)}},g=e=>t=>{null==o||o(),u(r=>({...r,[e]:t.target.value}))};return(0,a.jsxs)("form",{className:"space-y-6",onSubmit:h,children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Usuario o Correo"}),(0,a.jsx)(c,{id:"username",name:"username",type:"text",autoComplete:"username email",required:!0,placeholder:"usuario@empresa.com",value:s.username,onChange:g("username"),disabled:d})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Contrase\xf1a"}),(0,a.jsx)(c,{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,placeholder:"••••••••",value:s.password,onChange:g("password"),disabled:d})]})]}),(0,a.jsx)(l,{type:"submit",className:"w-full",disabled:d||!s.username||!s.password,children:d?"Iniciando sesi\xf3n...":"Iniciar Sesi\xf3n"})]})}var d=r(7320),m=r(5889);function h(){let{user:e,isAuthenticated:t,isLoading:r,login:i}=(0,s.a)(),l=(0,o.useRouter)(),[c,h]=(0,n.useState)(null);return((0,n.useEffect)(()=>{t&&e&&l.push("/chat")},[t,e,l]),r||t&&e)?(0,a.jsx)(d.Z,{}):(0,a.jsxs)("main",{className:"min-h-screen bg-gradient-to-br from-primary-50 to-secondary-50 dark:from-dark-900 dark:to-dark-800 flex items-center justify-center p-4",children:[(0,a.jsx)("div",{className:"absolute top-4 right-4",children:(0,a.jsx)(m.T,{})}),(0,a.jsx)("div",{className:"w-full max-w-md",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-dark-800 rounded-2xl shadow-xl p-8",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-white rounded-full mb-4 p-2 shadow-lg",children:(0,a.jsx)("img",{src:"/renovables-logo.png",alt:"Renovables del Sur MX",className:"w-full h-full object-contain"})}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Renovables del Sur M\xe9xico"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Accede a Renobot, nuestro asistente inteligente"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-2",children:"Usa tu nombre de usuario o correo electr\xf3nico"})]}),c&&(0,a.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative mb-6",role:"alert",children:(0,a.jsx)("span",{className:"block sm:inline",children:c})}),(0,a.jsx)(u,{onLoginSuccess:(e,t)=>{i(e,t)},onLoginError:e=>{h(e.includes("Authentication failed")?"Credenciales incorrectas. Por favor, verifica tu usuario y contrase\xf1a.":"Ocurri\xf3 un error inesperado. Por favor, int\xe9ntalo de nuevo.")},onInputChange:()=>h(null)}),(0,a.jsx)("div",{className:"mt-6 text-center",children:(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"\xbfNecesitas ayuda? Contacta al administrador"})})]})})]})}},7320:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});var a=r(7437);function n(){return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-blue-100 dark:bg-blue-900 mb-4",children:(0,a.jsx)("div",{className:"w-6 h-6 border-2 border-blue-600 dark:border-blue-400 border-t-transparent rounded-full animate-spin"})}),(0,a.jsx)("h2",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Verificando autenticaci\xf3n..."}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Un momento por favor"})]})})}},5889:function(e,t,r){"use strict";r.d(t,{T:function(){return l}});var a=r(7437),n=r(8301);let o=(0,n.Z)("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]),s=(0,n.Z)("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);var i=r(6380);function l(){let{theme:e,toggleTheme:t}=(0,i.Fg)();return(0,a.jsx)("button",{onClick:t,className:"p-2 rounded-lg bg-gray-200 dark:bg-dark-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-dark-600 transition-colors duration-200","aria-label":"Toggle theme",children:"light"===e?(0,a.jsx)(o,{className:"h-5 w-5"}):(0,a.jsx)(s,{className:"h-5 w-5"})})}},6281:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return i},a:function(){return l}});var a=r(7437),n=r(2265),o=r(4502);let s=(0,n.createContext)(void 0);function i(e){let{children:t}=e,[r,i]=(0,n.useState)(null),[l,c]=(0,n.useState)(!0),u=async()=>{let e=localStorage.getItem("authToken"),t=localStorage.getItem("currentUser");if(!e||!t)return c(!1),!1;try{let r=JSON.parse(t);try{let e=await o.x.getProfile();i(e),localStorage.setItem("currentUser",JSON.stringify(e))}catch(t){i(r),o.x.setToken(e)}return c(!1),!0}catch(e){return console.error("Auth check failed:",e),localStorage.removeItem("authToken"),localStorage.removeItem("currentUser"),o.x.clearToken(),i(null),c(!1),!1}};return(0,n.useEffect)(()=>{u()},[]),(0,a.jsx)(s.Provider,{value:{user:r,isLoading:l,isAuthenticated:!!r,login:(e,t)=>{localStorage.setItem("authToken",t),localStorage.setItem("currentUser",JSON.stringify(e)),o.x.setToken(t),i(e)},logout:()=>{localStorage.removeItem("authToken"),localStorage.removeItem("currentUser"),Object.keys(localStorage).forEach(e=>{e.startsWith("conversations_")&&localStorage.removeItem(e)}),o.x.clearToken(),i(null)},checkAuth:u},children:t})}function l(){let e=(0,n.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},6380:function(e,t,r){"use strict";r.d(t,{Fg:function(){return o},Gd:function(){return s},Ni:function(){return n}});var a=r(2265);let n=(0,a.createContext)(void 0);function o(){let e=(0,a.useContext)(n);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}function s(){let[e,t]=(0,a.useState)("light");return(0,a.useEffect)(()=>{let e=localStorage.getItem("theme"),r=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",a=e||r;t(a),document.documentElement.classList.toggle("dark","dark"===a)},[]),{theme:e,toggleTheme:()=>{let r="light"===e?"dark":"light";t(r),localStorage.setItem("theme",r),document.documentElement.classList.toggle("dark","dark"===r)}}}},4502:function(e,t,r){"use strict";r.d(t,{x:function(){return o}});let a="".concat("https://renovablesdelsurmx.online:8443","/api/chatbot");class n{setToken(e){this.token=e,localStorage.setItem("authToken",e)}clearToken(){this.token=null,localStorage.removeItem("authToken")}getToken(){return this.token}getBaseUrl(){return a}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r="".concat(a).concat(e),n={"Content-Type":"application/json",...t.headers};this.token&&(n.Authorization="Bearer ".concat(this.token));try{let e=await fetch(r,{...t,headers:n});if(!e.ok){if(401===e.status)throw this.clearToken(),Error("Authentication failed");throw Error("HTTP error! status: ".concat(e.status))}return await e.json()}catch(e){throw console.error("API request failed:",e),e}}async login(e){let t=await this.request("/employee/login/",{method:"POST",body:JSON.stringify(e)});return t.success&&this.setToken(t.access),t}async getProfile(){return await this.request("/employee/profile/")}async getConversations(){return await this.request("/employee/conversations/")}async getConversation(e){return await this.request("/employee/conversations/".concat(e,"/"))}async sendMessage(e,t){var r,a,n,o,s,i;let l={message:e.message,conversation_id:e.conversation_id,has_file:e.has_file||!1,file:e.file?{name:e.file.name,size:e.file.size,type:e.file.type,extension:e.file.extension,data:e.file.data}:null,user:t?{email:t.email,username:t.username,full_name:null===(r=t.employee)||void 0===r?void 0:r.full_name,department:null===(a=t.employee)||void 0===a?void 0:a.department,role:null===(n=t.employee)||void 0===n?void 0:n.role_name,role_code:null===(o=t.employee)||void 0===o?void 0:o.role_code,employee_id:null===(s=t.employee)||void 0===s?void 0:s.employee_id}:null};try{let t=Date.now(),r=await fetch("https://n8n.srv865372.hstgr.cloud/webhook/615091e3-d7c3-477d-9d64-fae01c60845b",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!r.ok)throw Error("HTTP error! status: ".concat(r.status));let a=await r.json(),n=Date.now(),o=(null===(i=a[0])||void 0===i?void 0:i.output)||"Lo siento, no pude obtener una respuesta.",s=e.conversation_id||crypto.randomUUID(),c={id:Date.now(),content:e.message,is_user:!0,timestamp:new Date().toISOString(),has_file:e.has_file||!1,file:e.file},u={id:Date.now()+1,content:o,is_user:!1,timestamp:new Date().toISOString(),response_time:n-t,has_file:!1};return{conversation_id:s,user_message:c,ai_response:u,source:"n8n_webhook"}}catch(e){throw console.error("API request failed:",e),e}}async uploadFile(e,t){let r=new FormData;r.append("file",t),r.append("file_name",t.name),r.append("file_type",t.type.startsWith("image/")?"image":"document");let n={};this.token&&(n.Authorization="Bearer ".concat(this.token));try{let t=await fetch("".concat(a,"/employee/conversations/").concat(e,"/upload/"),{method:"POST",headers:n,body:r});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return await t.json()}catch(e){throw console.error("File upload failed:",e),e}}logout(){this.clearToken()}constructor(){this.token=null,this.token=localStorage.getItem("authToken")}}let o=new n},9376:function(e,t,r){"use strict";var a=r(5475);r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}})},8301:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var a=r(2265),n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();var s=(e,t)=>{let r=(0,a.forwardRef)((r,s)=>{let{color:i="currentColor",size:l=24,strokeWidth:c=2,absoluteStrokeWidth:u,children:d,...m}=r;return(0,a.createElement)("svg",{ref:s,...n,width:l,height:l,stroke:i,strokeWidth:u?24*Number(c)/Number(l):c,className:"lucide lucide-".concat(o(e)),...m},[...t.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...(Array.isArray(d)?d:[d])||[]])});return r.displayName="".concat(e),r}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=5262)}),_N_E=e.O()}]);