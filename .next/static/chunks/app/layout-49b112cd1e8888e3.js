(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{3891:function(e,t,o){Promise.resolve().then(o.bind(o,3396)),Promise.resolve().then(o.bind(o,6281)),Promise.resolve().then(o.t.bind(o,4742,23)),Promise.resolve().then(o.t.bind(o,7960,23))},3396:function(e,t,o){"use strict";o.d(t,{ThemeProvider:function(){return a}});var n=o(7437),r=o(6380);function a(e){let{children:t}=e,o=(0,r.Gd)();return(0,n.jsx)(r.Ni.Provider,{value:o,children:t})}},6281:function(e,t,o){"use strict";o.d(t,{AuthProvider:function(){return i},a:function(){return l}});var n=o(7437),r=o(2265),a=o(4502);let s=(0,r.createContext)(void 0);function i(e){let{children:t}=e,[o,i]=(0,r.useState)(null),[l,c]=(0,r.useState)(!0),u=async()=>{let e=localStorage.getItem("authToken"),t=localStorage.getItem("currentUser");if(!e||!t)return c(!1),!1;try{let o=JSON.parse(t);try{let e=await a.x.getProfile();i(e),localStorage.setItem("currentUser",JSON.stringify(e))}catch(t){i(o),a.x.setToken(e)}return c(!1),!0}catch(e){return console.error("Auth check failed:",e),localStorage.removeItem("authToken"),localStorage.removeItem("currentUser"),a.x.clearToken(),i(null),c(!1),!1}};return(0,r.useEffect)(()=>{u()},[]),(0,n.jsx)(s.Provider,{value:{user:o,isLoading:l,isAuthenticated:!!o,login:(e,t)=>{localStorage.setItem("authToken",t),localStorage.setItem("currentUser",JSON.stringify(e)),a.x.setToken(t),i(e)},logout:()=>{localStorage.removeItem("authToken"),localStorage.removeItem("currentUser"),Object.keys(localStorage).forEach(e=>{e.startsWith("conversations_")&&localStorage.removeItem(e)}),a.x.clearToken(),i(null)},checkAuth:u},children:t})}function l(){let e=(0,r.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},6380:function(e,t,o){"use strict";o.d(t,{Fg:function(){return a},Gd:function(){return s},Ni:function(){return r}});var n=o(2265);let r=(0,n.createContext)(void 0);function a(){let e=(0,n.useContext)(r);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}function s(){let[e,t]=(0,n.useState)("light");return(0,n.useEffect)(()=>{let e=localStorage.getItem("theme"),o=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",n=e||o;t(n),document.documentElement.classList.toggle("dark","dark"===n)},[]),{theme:e,toggleTheme:()=>{let o="light"===e?"dark":"light";t(o),localStorage.setItem("theme",o),document.documentElement.classList.toggle("dark","dark"===o)}}}},4502:function(e,t,o){"use strict";o.d(t,{x:function(){return a}});let n="".concat("https://renovablesdelsurmx.online:8443","/api/chatbot");class r{setToken(e){this.token=e,localStorage.setItem("authToken",e)}clearToken(){this.token=null,localStorage.removeItem("authToken")}getToken(){return this.token}getBaseUrl(){return n}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o="".concat(n).concat(e),r={"Content-Type":"application/json",...t.headers};this.token&&(r.Authorization="Bearer ".concat(this.token));try{let e=await fetch(o,{...t,headers:r});if(!e.ok){if(401===e.status)throw this.clearToken(),Error("Authentication failed");throw Error("HTTP error! status: ".concat(e.status))}return await e.json()}catch(e){throw console.error("API request failed:",e),e}}async login(e){let t=await this.request("/employee/login/",{method:"POST",body:JSON.stringify(e)});return t.success&&this.setToken(t.access),t}async getProfile(){return await this.request("/employee/profile/")}async getConversations(){return await this.request("/employee/conversations/")}async getConversation(e){return await this.request("/employee/conversations/".concat(e,"/"))}async sendMessage(e,t){var o,n,r,a,s,i;let l={message:e.message,conversation_id:e.conversation_id,has_file:e.has_file||!1,file:e.file?{name:e.file.name,size:e.file.size,type:e.file.type,extension:e.file.extension,data:e.file.data}:null,user:t?{email:t.email,username:t.username,full_name:null===(o=t.employee)||void 0===o?void 0:o.full_name,department:null===(n=t.employee)||void 0===n?void 0:n.department,role:null===(r=t.employee)||void 0===r?void 0:r.role_name,role_code:null===(a=t.employee)||void 0===a?void 0:a.role_code,employee_id:null===(s=t.employee)||void 0===s?void 0:s.employee_id}:null};try{let t=Date.now(),o=await fetch("https://n8n.srv865372.hstgr.cloud/webhook/615091e3-d7c3-477d-9d64-fae01c60845b",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!o.ok)throw Error("HTTP error! status: ".concat(o.status));let n=await o.json(),r=Date.now(),a=(null===(i=n[0])||void 0===i?void 0:i.output)||"Lo siento, no pude obtener una respuesta.",s=e.conversation_id||crypto.randomUUID(),c={id:Date.now(),content:e.message,is_user:!0,timestamp:new Date().toISOString(),has_file:e.has_file||!1,file:e.file},u={id:Date.now()+1,content:a,is_user:!1,timestamp:new Date().toISOString(),response_time:r-t,has_file:!1};return{conversation_id:s,user_message:c,ai_response:u,source:"n8n_webhook"}}catch(e){throw console.error("API request failed:",e),e}}async uploadFile(e,t){let o=new FormData;o.append("file",t),o.append("file_name",t.name),o.append("file_type",t.type.startsWith("image/")?"image":"document");let r={};this.token&&(r.Authorization="Bearer ".concat(this.token));try{let t=await fetch("".concat(n,"/employee/conversations/").concat(e,"/upload/"),{method:"POST",headers:r,body:o});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return await t.json()}catch(e){throw console.error("File upload failed:",e),e}}logout(){this.clearToken()}constructor(){this.token=null,this.token=localStorage.getItem("authToken")}}let a=new r},7960:function(){},4742:function(e){e.exports={style:{fontFamily:"'__Inter_5b89bc', '__Inter_Fallback_5b89bc'",fontStyle:"normal"},className:"__className_5b89bc"}}},function(e){e.O(0,[540,971,117,744],function(){return e(e.s=3891)}),_N_E=e.O()}]);